<!DOCTYPE html>
<html lang="de" data-theme="light">
<head>
    <meta charset="UTF-8">
    <title>Security Event Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Styles -->
    <link rel="stylesheet" href="src/css/styles.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- jsPDF + AutoTable (f√ºr PDF Export) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
<div class="app-shell">
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <!-- Brand / Header -->
        <div class="sidebar-header">
            <div class="brand">SEC<span>GUARD</span></div>
            <div class="subtitle">
                Security Event Dashboard<br>
                Echtzeit-Auswertung von Ereignisdaten
            </div>
        </div>

        <!-- Datenquelle -->
        <section class="sidebar-section">
            <div class="sidebar-section-title">Datenquelle</div>

            <div class="file-input-wrapper">
                <label for="fileInput">
                    <span>CSV-Datei importieren</span>
                    <span class="hint">
                        Erwartet Spalten wie <strong>Land</strong>, <strong>Liegenschaft</strong>,
                        <strong>Ereignisart</strong>, <strong>Datum</strong>.<br>
                        Trennzeichen: <strong>;</strong> oder <strong>,</strong>
                    </span>
                    <input id="fileInput" type="file" accept=".csv,text/csv">
                </label>
            </div>

            <button id="loadTestData" class="btn primary">Testdaten laden</button>

            <div id="modeIndicator" class="status mt-2">Modus: Noch keine Daten</div>
            <div id="fileStatus" class="status hint">Bitte CSV laden oder Testdaten verwenden.</div>
            <div class="status mt-1">
                <span class="font-medium">Datens√§tze gesamt: </span>
                <span id="recordCount">0</span>
            </div>
        </section>

        <!-- Filter -->
        <section class="sidebar-section">
            <div class="sidebar-section-title">Filter</div>

            <div class="filters">
                <div class="filter-row">
                    <label for="filterCountry">Land</label>
                    <select id="filterCountry">
                        <option value="__ALL__">Alle L√§nder</option>
                    </select>
                </div>

                <div class="filter-row">
                    <label for="filterSite">Liegenschaft</label>
                    <select id="filterSite">
                        <option value="__ALL__">Alle Liegenschaften</option>
                    </select>
                </div>

                <div class="filter-row">
                    <label for="filterType">Ereignisart</label>
                    <select id="filterType">
                        <option value="__ALL__">Alle Ereignisarten</option>
                    </select>
                </div>

                <button id="resetFilters" class="btn secondary mt-2">Filter zur√ºcksetzen</button>

                <div id="filterStatus" class="status mt-1">
                    Zeige 0 von 0 Datens√§tzen
                </div>
            </div>
        </section>

        <!-- Risiko-Konfiguration -->
        <section class="sidebar-section">
            <div class="sidebar-section-title">Risikogewichtung</div>
            <div class="hint mb-2">
                Gewichte (1‚Äì10) f√ºr Ereignisarten. H√∂her = st√§rkeres Sicherheitsrisiko.
            </div>

            <div id="riskConfigContainer" class="risk-config">
                <div class="hint">
                    Noch keine Ereignisarten erkannt. Bitte Daten laden.
                </div>
            </div>
        </section>
    </aside>

    <!-- MAIN -->
    <main class="main">
        <!-- TOP BAR -->
        <header class="top-bar">
            <!-- Theme Toggle -->
            <div class="theme-toggle-wrapper">
                <div id="themeToggle" class="theme-toggle" role="button" aria-label="Theme umschalten">
                    <span class="theme-icon sun">‚òÄÔ∏è</span>
                    <span class="theme-icon moon">üåô</span>
                    <div class="theme-toggle-slider"></div>
                </div>
                <span class="theme-label">Dark Mode</span>
            </div>

            <!-- Sprache -->
            <div class="language-select-wrapper">
                <label for="reportLanguage">Report-Sprache</label>
                <select id="reportLanguage">
                    <option value="de" selected>Deutsch</option>
                    <option value="en">English</option>
                </select>
            </div>

            <!-- Export Buttons -->
            <div>
                <button id="exportCSV" class="btn outline-light">CSV exportieren</button>
                <button id="exportPDF" class="btn primary">PDF Report</button>
            </div>
        </header>

        <!-- HEADER & KPIs -->
        <section class="main-header">
            <div>
                <h1>Security Event Dashboard</h1>
                <div class="main-header-subtitle">
                    Konsolidierte √úbersicht √ºber sicherheitsrelevante Ereignisse, Standorte und Trends.
                </div>

                <div class="mt-2">
                    <span class="pill">
                        <span class="font-medium">Events gesamt: </span>
                        <span id="kpiTotalEvents">0</span>
                    </span>
                    <span class="pill secondary">
                        <span id="kpiTotalEventsSub">0 nach Filter</span>
                    </span>
                </div>
            </div>

            <div class="main-header-right">
                <div>
                    L√§nder: <span class="font-bold" id="kpiCountries">0</span> ¬∑
                    Liegenschaften: <span class="font-bold" id="kpiSites">0</span> ¬∑
                    Ereignisarten: <span class="font-bold" id="kpiTypes">0</span>
                </div>
                <div class="hint">
                    Basis f√ºr PDF-Report und Export-Funktionen.
                </div>
            </div>
        </section>

        <!-- KPI CARDS -->
        <section class="card-grid">
            <div class="card">
                <div class="card-title">Events gesamt</div>
                <div class="card-value" id="kpiTotalEventsCard">0</div>
                <div class="card-subvalue">Alle eingelesenen Ereignisse</div>
            </div>

            <div class="card">
                <div class="card-title">L√§nder</div>
                <div class="card-value" id="kpiCountriesCard">0</div>
                <div class="card-subvalue">Mit registrierten Events</div>
            </div>

            <div class="card">
                <div class="card-title">Liegenschaften</div>
                <div class="card-value" id="kpiSitesCard">0</div>
                <div class="card-subvalue">Einzigartige Standorte</div>
            </div>

            <div class="card">
                <div class="card-title">Event-Typen</div>
                <div class="card-value" id="kpiTypesCard">0</div>
                <div class="card-subvalue">Unterschiedliche Ereignisarten</div>
            </div>
        </section>

        <!-- CONTENT GRID -->
        <section class="content-grid">
            <!-- LINKS: Tabellen & Charts -->
            <div class="panel">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Aggregierte √úbersicht</div>
                        <div class="panel-subtitle">
                            Anzahl der Ereignisse nach L√§ndern, Liegenschaften und Ereignisarten.
                        </div>
                    </div>
                </div>

                <!-- Tabellen -->
                <div class="panel">
                    <h3>Nach L√§ndern</h3>
                    <div class="table-wrapper">
                        <table id="tableByCountry">
                            <thead>
                                <tr>
                                    <th>Land</th>
                                    <th>Anzahl</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="2" class="empty-state">Keine Daten</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>Nach Liegenschaften</h3>
                    <div class="table-wrapper">
                        <table id="tableBySite">
                            <thead>
                                <tr>
                                    <th>Liegenschaft</th>
                                    <th>Land</th>
                                    <th>Anzahl</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="3" class="empty-state">Keine Daten</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>Nach Ereignisart</h3>
                    <div class="table-wrapper">
                        <table id="tableByType">
                            <thead>
                                <tr>
                                    <th>Ereignisart</th>
                                    <th>Anzahl</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="2" class="empty-state">Keine Daten</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- RECHTS: Charts & Analytics -->
            <div class="panel">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Visualisierung</div>
                        <div class="panel-subtitle">
                            Grafische Darstellung der Ereignisverteilung.
                        </div>
                    </div>
                </div>

                <h3>Nach L√§ndern</h3>
                <div id="chartCountries" class="chart">
                    <div class="empty-state">
                        <strong>Keine Daten</strong>
                        <span>Bitte CSV importieren oder Testdaten laden.</span>
                    </div>
                </div>

                <h3>Nach Liegenschaften</h3>
                <div id="chartSites" class="chart">
                    <div class="empty-state">
                        <strong>Keine Daten</strong>
                        <span>Bitte CSV importieren oder Testdaten laden.</span>
                    </div>
                </div>

                <h3>Nach Ereignisart</h3>
                <div id="chartTypes" class="chart">
                    <div class="empty-state">
                        <strong>Keine Daten</strong>
                        <span>Bitte CSV importieren oder Testdaten laden.</span>
                    </div>
                </div>

                <h3>Bereichsverteilung</h3>
                <div id="chartDomains" class="chart">
                    <div class="empty-state">
                        <strong>Keine Daten</strong>
                        <span>Events werden automatisch den Bereichen Security, FM, SHE zugeordnet.</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- SMART ANALYTICS PANEL -->
        <section class="analytics-panel">
            <div class="panel-header">
                <div>
                    <div class="panel-title">Smart Analytics</div>
                    <div class="panel-subtitle">
                        Automatische Risikoanalyse, Mustererkennung und Handlungsempfehlungen.
                    </div>
                </div>
            </div>

            <div class="insights-grid">
                <!-- Risiko -->
                <div class="insight-card">
                    <div class="insight-header">
                        <div class="insight-icon">üõë</div>
                        <h3>Risiko-Einsch√§tzung</h3>
                    </div>
                    <div id="riskAssessment" class="insight-content">
                        <div class="loading">Keine Daten f√ºr Analyse</div>
                    </div>
                </div>

                <!-- Muster -->
                <div class="insight-card">
                    <div class="insight-header">
                        <div class="insight-icon">üìä</div>
                        <h3>Muster & Bereiche</h3>
                    </div>
                    <div id="patternDetection" class="insight-content">
                        <div class="loading">Keine Daten f√ºr Analyse</div>
                    </div>
                </div>

                <!-- Empfehlungen -->
                <div class="insight-card">
                    <div class="insight-header">
                        <div class="insight-icon">üí°</div>
                        <h3>Empfehlungen</h3>
                    </div>
                    <div id="smartRecommendations" class="insight-content">
                        <div class="loading">Keine Daten f√ºr Analyse</div>
                    </div>
                </div>

                <!-- Trend -->
                <div class="insight-card">
                    <div class="insight-header">
                        <div class="insight-icon">üìà</div>
                        <h3>Trend & Forecast</h3>
                    </div>
                    <div id="trendForecast" class="insight-content">
                        <div class="loading">Keine Daten f√ºr Analyse</div>
                    </div>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- Toast Container -->
<div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

<!-- App Script -->
<script src="app.js"></script>
</body>
</html>
